<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.test.mybatis.IAdminNoticeDAO">

	<sql id="where">
		<choose>
			<when test="searchType=='num'.toString()">
				WHERE NT_CODE = #{keyword}
			</when>
		</choose>
		<choose>
			<when test="searchType=='title'.toString()">
				WHERE NT_TITLE  LIKE'%' || #{keyword} || '%'
			</when>
		</choose>
		<choose>
			<when test="searchType=='adCode'.toString()">
				WHERE AD_CODE = #{keyword}
			</when>
		</choose>
	</sql>

	
	<!-- 관리자 화면에서 공지사항 리스트 조회 -->
	<select id="list" resultType="com.test.mybatis.NoticeDTO">
		SELECT NUM , NTCODE,  NTTITLE,  NTCONTENT, NTDATE,  NTVIEW, NTMODATE,  ADCODE
		FROM 
		(
		SELECT ROW_NUMBER() OVER(ORDER BY TO_NUMBER(NT_CODE) DESC ) AS NUM, NT_CODE AS NTCODE, NT_TITLE AS NTTITLE, NT_CONTENT AS NTCONTENT, TO_CHAR(NT_DATE, 'YYYY-MM-DD') AS NTDATE, NT_VIEW AS NTVIEW, NT_MODATE AS NTMODATE , AD_CODE AS ADCODE
		FROM NOTICE
		ORDER BY TO_NUMBER(NT_CODE) DESC
		)
		WHERE NUM BETWEEN 1+((#{VNUM}-1)*10) AND (#{VNUM}*10)
	</select>
	
	<!-- 관리자 화면에서 공지사항 검색-->
	<select id="searchList" parameterType="hashmap" resultType="com.test.mybatis.NoticeDTO"  >
		SELECT NUM , NTCODE,  NTTITLE,  NTCONTENT, NTDATE,  NTVIEW, NTMODATE,  ADCODE
		FROM 
		(
		SELECT ROW_NUMBER() OVER(ORDER BY TO_NUMBER(NT_CODE) DESC ) AS NUM, NT_CODE AS NTCODE, NT_TITLE AS NTTITLE, NT_CONTENT AS NTCONTENT, TO_CHAR(NT_DATE) AS NTDATE, NT_VIEW AS NTVIEW, NT_MODATE AS NTMODATE , AD_CODE AS ADCODE
		FROM NOTICE
		<include refid="where"></include>
		ORDER BY TO_NUMBER(NT_CODE) DESC
		)
		WHERE NUM BETWEEN 1+((#{vNum}-1)*10) AND (#{vNum}*10)
		
	</select>
		
		
		
	<!-- 공지사항 갯수 확인 -->
	<select id="count" resultType="java.lang.Integer">
		SELECT COUNT(*) AS COUNT
		FROM NOTICE
	</select>
	
		<!-- 공지사항 갯수 확인 -->
	<select id="searchCount" parameterType="hashmap" resultType="java.lang.Integer">
		SELECT COUNT(*) AS COUNT
		FROM NOTICE
		<include refid="where"></include>
	</select>
	
	<!-- 관리자 화면에서 공지사항 작성 -->
	<insert id="add">
		INSERT INTO NOTICE(NT_CODE, NT_TITLE, NT_CONTENT, AD_CODE)
		VALUES(TO_CHAR(NOTICE_SEQ.NEXTVAL), #{ntTitle}, #{ntContent}, #{adCode})
	</insert>	
	
	<!-- 관리자 화면에서 공지사항 수정 -->
	<update id="modify">
		UPDATE NOTICE
		SET NT_TITLE = #{ntTitle}, NT_CONTENT = #{ntContent}, NT_MODATE = SYSDATE
		WHERE NT_CODE = #{ntCode}
	</update>
	
	<!-- 관리자 화면에서 공지사항 수정 -->	
	<delete id="remove">
		DELETE
		FROM NOTICE
		WHERE NT_CODE = #{ntCode}
	</delete>		

</mapper>